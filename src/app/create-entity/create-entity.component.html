<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="header">
                Create New Entity
            </div>
            <div class="header">
                <div class="name-div">
                    <label for="entityName">Entity Name</label>
                    <input
                        type="text"
                        id="entityName"
                        name="entityName"
                        placeholder="Enter your entity name here"
                        [(ngModel)]="newEntity.entityname"
                        required
                        pattern="^[a-zA-Z][a-zA-Z0-9]*$"
                        #entityNameInput="ngModel"
                    />
                    <!-- Validation error messages -->
                    <div *ngIf="entityNameInput.invalid && (entityNameInput.dirty || entityNameInput.touched)">
                        <div class="error" *ngIf="entityNameInput?.errors?.['required']">Entity Name is required.</div>
                        <div class="error" *ngIf="entityNameInput?.errors?.['pattern']">
                            Entity Name should start with a letter and contain only letters and numbers.
                        </div>
                    </div>
                </div>
                <div class="back-div">
                    <button class="back-button" routerLink="/entity-list"><i class="fa-solid fa-arrow-left icon"></i>Back</button>
                </div>
            </div>
            <div class="container table-container">
                <form (ngSubmit)="submit()" #entityForm="ngForm">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="center-header">Column Name</th>
                                <th class="center-header">Data Type</th>
                                <th class="center-header">Length</th>
                                <th class="center-header">NotNull</th>
                                <th class="center-header">PrimaryKey</th>
                                <th class="center-header">Default Value</th>
                                <th class="center-header">Description</th>
                                <th class="center-header">Remove</th>
                            </tr>
                        </thead>
                        <tbody>
                        
                            <tr *ngFor="let row of newEntity.columns; let i = index" [ngClass]="{'error-row': !rowValid(i)}">
                                <td class="center-content">
                                    <input
                                        type="text"
                                        [(ngModel)]="row.columnName"
                                        placeholder="Column Name"
                                        name="columnName{{ i }}"
                                        required
                                        pattern="^[a-zA-Z][a-zA-Z0-9]*$"
                                        #columnNameInput="ngModel"
                                    />
                                    <!-- Validation error messages -->
                                    <div *ngIf="columnNameInput.invalid && (columnNameInput.dirty || columnNameInput.touched)">
                                        <div class="error" *ngIf="columnNameInput?.errors?.['required']">Column Name is required.</div>
                                        <div class="error" *ngIf="columnNameInput?.errors?.['pattern']">
                                            It should start with a letter and contain only letters and numbers.
                                        </div>
                                    </div>
                                </td>
                                <td class="center-content">
                                    <select [(ngModel)]="row.datatype" name="datatype{{ i }}" required (change)="onDataTypeChange(row)">
                                        <option value="string">String</option>
                                        <option value="int">Number</option>
                                        <option value="boolean">Boolean</option>
                                        <option value="char">Char</option>
                                        <option value="date">Date</option>
                                        <option value="timestamp">Timestamp</option>
                                        <option value="bytea">ByteA</option>
                                    </select>
                                </td>
                                <td class="center-content">
                                    <input
                                        type="number"
                                        min="0"
                                        [(ngModel)]="row.length"
                                        placeholder="Length"
                                        name="length{{ i }}"
                                        [disabled]="row.datatype === 'int' || row.datatype === 'boolean' || row.datatype === 'char' ||
                                                    row.datatype === 'date' || row.datatype === 'bytea'"
                                        [class.disabled-input]="row.datatype === 'int' || row.datatype === 'boolean' || row.datatype === 'char' ||
                                                                row.datatype === 'date' || row.datatype === 'bytea'"
                                        pattern="[0-9]{1,5}"
                                        (input)="onInput($event)"
                                    />
                                </td>
                                
                                
                                <td class="center-content">
                                    <!-- Toggle Switch for Not Null -->
                                    <label class="toggle-switch">
                                        <input type="checkbox" [(ngModel)]="row.isNullable" name="isNullable{{ i }}" />
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td class="center-content">
                                    <!-- Toggle Switch for Primary Key -->
                                    <label class="toggle-switch">
                                        <input type="checkbox" [(ngModel)]="row.primaryKey" name="primaryKey{{ i }}" />
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <!-- Inside the table row for Default Value -->
                                 <td class="center-content">
                                  <ng-container *ngIf="row.datatype !== 'boolean' && row.datatype !== 'date' && row.datatype !== 'timestamp'; else booleanOrDate">
                                   <input type="text" [(ngModel)]="row.defaultValue" placeholder="Default Value" name="defaultValue{{ i }}" />
                                  </ng-container>
                                <ng-template #booleanOrDate>
                                 <!-- Dropdown for 'boolean' or calendar input for 'date' and 'timestamp' -->
                                <select *ngIf="row.datatype === 'boolean'" [(ngModel)]="row.defaultValue" name="defaultValue{{ i }}">
                                  <option value="true">True</option>
                                  <option value="false">False</option>
                                </select>
                                <input
                                *ngIf="row.datatype === 'date' || row.datatype === 'timestamp'"
                                 type="date"
                                 [(ngModel)]="row.defaultValue"
                                 name="defaultValue{{ i }}"
                                 />
                                </ng-template>
                                </td>
                                <td class="center-content"><input type="text" [(ngModel)]="row.description" placeholder="Description" name="description{{ i }}" /></td>
                                <td class="center-content">
                                    <!-- Delete Row Button -->
                                    <button class="delete-button" (click)="deleteRow(i)"><i class="fa-solid fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="header">
                        <div class="buttons">
                            <button class="sub-button" [disabled]="entityForm.invalid" type="submit">Submit</button>
                        </div>
                        <div class="buttons">
                            <button class="add-button" (click)="addNewRow()"><i style="margin-inline-end: 10px;" class="fa-solid fa-plus"></i>Add Row</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


